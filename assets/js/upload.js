(function(e){window.CPM_Uploader=function(t,n){this.container=n;this.browse_button=t;if(!e("#"+t).length)return;this.uploader=new plupload.Uploader({runtimes:"html5,silverlight,flash,html4",browse_button:t,container:n,multipart:!0,multipart_params:[],multiple_queues:!1,urlstream_upload:!0,file_data_name:"cpm_attachment",max_file_size:CPM_Vars.plupload.max_file_size,url:CPM_Vars.plupload.url,flash_swf_url:CPM_Vars.plupload.flash_swf_url,silverlight_xap_url:CPM_Vars.plupload.silverlight_xap_url,filters:CPM_Vars.plupload.filters,resize:CPM_Vars.plupload.resize});this.uploader.bind("Init",e.proxy(this,"init"));this.uploader.bind("FilesAdded",e.proxy(this,"added"));this.uploader.bind("QueueChanged",e.proxy(this,"upload"));this.uploader.bind("UploadProgress",e.proxy(this,"progress"));this.uploader.bind("Error",e.proxy(this,"error"));this.uploader.bind("FileUploaded",e.proxy(this,"uploaded"));this.uploader.init()};CPM_Uploader.prototype={init:function(e,t){},added:function(t,n){var r=e("#"+this.container).find(".cpm-upload-filelist");e.each(n,function(e,t){r.append('<div class="upload-item" id="'+t.id+'"><div class="progress"><div class="percent">0%</div><div class="bar"></div></div><div class="filename original">'+t.name+" ("+plupload.formatSize(t.size)+") <b></b>"+"</div></div>")});t.refresh()},upload:function(e){this.uploader.start()},progress:function(t,n){var r=e("#"+n.id);e(".bar",r).width(200*n.loaded/n.size);e(".percent",r).html(n.percent+"%")},error:function(t,n){e("#"+this.container).find("#"+n.file.id).remove();alert("Error #"+n.code+": "+n.message)},uploaded:function(t,n,r){var i=e.parseJSON(r.response);e("#"+n.id+" b").html("100%");e("#"+n.id).remove();if(i.success){var s=e("#"+this.container).find(".cpm-upload-filelist");s.append(i.content)}else alert(i.error)}};e(function(){new CPM_Uploader("cpm-upload-pickfiles","cpm-upload-container")})})(jQuery);